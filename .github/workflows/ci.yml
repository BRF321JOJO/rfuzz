name: rfuzz Instrumentation and Harness CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Install Dependencies
      run: |
       sudo apt-get install -y build-essential meson pkg-config openjdk-8-jdk verilator cargo
       sudo apt-get install -y python3-toml python3-numpy python3-matplotlib graphviz

    - name: Set up JDK 11
      uses: actions/setup-java@v1
      with:
        java-version: 11

    - name: ICache
      run: make FIR=ICache.fir DUT=ICache bin

    - name: ICache w/ Coverage
      run: make FIR=ICacheCover.fir DUT=ICache bin

    - name: Non-Blocking Data Cache
      run: make FIR=NonBlockingDCache.fir DUT=NonBlockingDCache bin

    - name: Sodor 1-Stage
      run: make FIR=Sodor1Stage.fir DUT=Sodor1Stage bin

    - name: Sodor 3-Stage
      run: make FIR=Sodor3Stage.fir DUT=Sodor3Stage bin

    - name: Sodor 5-Stage
      run: make FIR=Sodor5Stage.fir DUT=Sodor5Stage bin

    - name: I2C Peripheral
      run: make FIR=TLI2C.fir DUT=TLI2C bin

    - name: PWM Peripheral
      run: make FIR=TLPWM.fir DUT=TLPWM bin

    - name: SPI Peripheral
      run: make FIR=TLSPI.fir DUT=TLSPI bin

    - name: UART Peripheral
      run: make FIR=TLUART.fir DUT=TLUART bin

    - name: FFT Small
      run: make FIR=FFTSmall.fir DUT=FFTSmall bin

    - name: Rocket Chip Tile
      run: make FIR=RocketTile.fir DUT=RocketTile bin
